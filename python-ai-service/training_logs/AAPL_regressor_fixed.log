WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1766956394.493167  370128 cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
[GPU] Mixed precision policy set to: mixed_float16
[GPU] Loss scaling ENABLED (automatic dynamic scaling)
[INFO] Training log initialized: /home/thunderboltdy/ai-stocks/python-ai-service/training_logs/AAPL_regressor_20251228_221320.log
[INFO] Starting regressor training for AAPL
[INFO] Arguments: epochs=30, batch_size=512, sequence_length=90, seed=42
W0000 00:00:1766956400.294940  370128 gpu_device.cc:2362] Cannot dlopen some GPU libraries. Please make sure the missing libraries mentioned above are installed properly if you would like to use GPU. Follow the guide at https://www.tensorflow.org/install/gpu for how to download and setup the required libraries for your platform.
Skipping registering GPU devices...
[GPU] No GPU found, using CPU

======================================================================
  TRAINING 1-DAY REGRESSOR: AAPL
======================================================================

Target scaler: RobustScaler (clipped to Â±0.15)
Log targets: False | Target noise std: 0.0001
Multi-task learning: DISABLED (single-task mode to prevent gradient conflicts)
Direction loss: True | Sequence length: 90
Loss: huber (quantile=n/a)
Target balancing: hybrid
ğŸ›¡ï¸  ANTI-COLLAPSE LOSS: ENABLED (AntiCollapseDirectionalLoss - prevents variance collapse)
Variance regularization: ENABLED (weight=1.0)
Feature selection: DISABLED (using all features)

[DATA] Loading data...
Technical features by category (expected sum): 116
Actual technical list length: 123
Difference from canonical 113: 10

âŒ DRIFT DETECTED!
Categories sum to: 116
List has: 123
Extra technical items (tail): ['latest_high_pivot', 'latest_low_pivot', 'dist_to_high_pivot', 'dist_to_low_pivot', 'vap_poc_price', 'dist_to_vap_poc', 'hvn_proximity', 'near_resistance_zone', 'near_support_zone', 'volume_concentration_score']
Technical features by category (expected sum): 116
Actual technical list length: 123
Difference from canonical 113: 10

âŒ DRIFT DETECTED!
Categories sum to: 116
List has: 123
Extra technical items (tail): ['latest_high_pivot', 'latest_low_pivot', 'dist_to_high_pivot', 'dist_to_low_pivot', 'vap_poc_price', 'dist_to_vap_poc', 'hvn_proximity', 'near_resistance_zone', 'near_support_zone', 'volume_concentration_score']
Technical features by category (expected sum): 116
Actual technical list length: 123
Difference from canonical 113: 10

âŒ DRIFT DETECTED!
Categories sum to: 116
List has: 123
Extra technical items (tail): ['latest_high_pivot', 'latest_low_pivot', 'dist_to_high_pivot', 'dist_to_low_pivot', 'vap_poc_price', 'dist_to_vap_poc', 'hvn_proximity', 'near_resistance_zone', 'near_support_zone', 'volume_concentration_score']
[INFO] [OK] Feature count validated: 157 features
   [OK] Loaded from cache: 11350 samples, 157 features
[INFO] Using all 157 features
   [OK] Using 1-DAY horizon (research optimal)
   [OK] Using 90-day sequences (quarterly context)

[DATA] Validating target distribution...
[INFO] 
[INFO] ============================================================
[INFO] TARGET DISTRIBUTION CHECK
[INFO] ============================================================
[INFO]    Positive: 50.0% (5,673 samples) | mean: +1.96%
[INFO]    Negative: 46.7% (5,306 samples) | mean: -1.95%
[INFO]    Zero:     3.3% (371 samples)
[INFO]    Overall:  mean=+0.070%, std=2.805%
[INFO] 
[INFO]    Percentiles:
[INFO]       10th: -2.825%
[INFO]       25th: -1.251%
[INFO]       50th: +0.000% (median)
[INFO]       75th: +1.412%
[INFO]       90th: +3.019%
[INFO] 
[INFO] [OK] Distribution is balanced
[INFO] ============================================================
[INFO]    [OK] Target distribution metadata saved to /home/thunderboltdy/ai-stocks/python-ai-service/saved_models/AAPL/target_distribution.json
I0000 00:00:1766956403.774493  370259 service.cc:153] XLA service 0x73b7f40ea430 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
I0000 00:00:1766956403.774526  370259 service.cc:161]   StreamExecutor device (0): Host, Default Version
I0000 00:00:1766956403.780226  370259 dump_mlir_util.cc:269] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.
I0000 00:00:1766956403.873375  370259 device_compiler.h:208] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.
   [OK] Target distribution validation passed
   [OK] Using precomputed target scaling from prepare_training_data. Scaled length: 11350

=== Target Scaling Verification ===
Original target range: [-0.731248, 0.286892]
Scaled target range: [-2.492277, 2.500403]
Scaled target stats: mean=0.000000, std=1.000000
Target scaler: (parameters not accessible)
Inverse transform roundtrip error: 0.00099622

[BALANCE] Applying target balancing (strategy: hybrid)...
   [OK] Balancing complete: 10,564 samples

   Train: 8451, Val: 2113

[BUILD] Building model...
   Single-task architecture with enhancements
   [OK] 870,785 parameters

[CHECK] Initial model prediction check...
   Initial predictions: std=0.069946, range=0.207031
   [OK] Initial predictions have healthy variance
   [OK] LR Schedule: warmup to 3.0e-05, min_lr=3.0e-05, drop 50% at epoch 40
   [MIXED PRECISION] LossScaleOptimizer enabled (prevents NaN in float16)
   [OK] Loss: ğŸ›¡ï¸ AntiCollapseDirectionalLoss (dir_weight=1.0, min_std=0.003, var_penalty=2.0)

[TRAIN] Training with LR warmup + cosine decay...
   Warmup: 10 epochs (0.00005 -> 0.0005)
   Cosine decay: 20 epochs (0.0005 -> 0.00001)

[CHECK] Validating training data...
   [OK] All training data validated (no NaN/Inf)
[INFO] 
=== Data Quality Pre-Check ===
[WARNING] [WARN] 38 features have near-zero variance
[INFO] Target range: [-1.2000, 1.2000]
[INFO] Target std: 0.7786 (should be ~1 after scaling)
[INFO] [OK] Data quality checks passed
[INFO] [OK] Training with 157 features (93 technical + 20 new + 34 sentiment)
[INFO]   Input shape: (8451, 90, 157) = (samples=8451, seq_len=90, features=157)

[OPTIMIZE] Creating optimized data pipeline for GPU...
[PIPELINE] Creating optimized tf.data.Dataset with batch_size=512
[PIPELINE] Enabled shuffling (buffer_size=4225)
[PIPELINE] Enabled caching - preprocessed data cached in memory
[PIPELINE] Enabled prefetching (buffer_size=2) - aggressive GPU feeding
[PIPELINE] Creating optimized tf.data.Dataset with batch_size=512
[PIPELINE] Enabled caching - preprocessed data cached in memory
[PIPELINE] Enabled prefetching (buffer_size=2) - aggressive GPU feeding

Epoch 1: LearningRateScheduler setting learning rate to 3e-06.
Epoch 1/30
W0000 00:00:1766956424.115841  370245 cpu_allocator_impl.cc:82] Allocation of 1301509200 exceeds 10% of free system memory.
W0000 00:00:1766956428.952683  370252 cpu_allocator_impl.cc:82] Allocation of 2933757954 exceeds 10% of free system memory.
[1m 1/17[0m [32mâ”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m6:04[0m 23s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000W0000 00:00:1766956430.438827  370253 cpu_allocator_impl.cc:82] Allocation of 1301509200 exceeds 10% of free system memory.
W0000 00:00:1766956434.087869  370253 cpu_allocator_impl.cc:82] Allocation of 2933757954 exceeds 10% of free system memory.
[1m 2/17[0m [32mâ”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m1:17[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000 W0000 00:00:1766956435.578951  370254 cpu_allocator_impl.cc:82] Allocation of 1301509200 exceeds 10% of free system memory.
[1m 3/17[0m [32mâ”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m1:11[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m 4/17[0m [32mâ”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m1:07[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m 5/17[0m [32mâ”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m1:02[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m 6/17[0m [32mâ”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m58s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000 [1m 7/17[0m [32mâ”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”[0m [1m52s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m 8/17[0m [32mâ”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”[0m [1m47s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m 9/17[0m [32mâ”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”[0m [1m42s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m10/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”[0m [1m36s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m11/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”[0m [1m31s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m12/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”â”[0m [1m26s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m13/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”[0m [1m21s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m14/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”[0m [1m15s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m15/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”[0m [1m10s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m16/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”[0m [1m5s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000 [1m17/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37m[0m [1m0s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m17/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37m[0m [1m114s[0m 6s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000 - val_directional_accuracy_metric: 0.0000e+00 - val_loss: nan - val_mae: nan - val_r_squared_metric: -1.0000 - learning_rate: 3.0000e-06

Epoch 2: LearningRateScheduler setting learning rate to 4.8e-06.
Epoch 2/30
[1m 1/17[0m [32mâ”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m1:25[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m 2/17[0m [32mâ”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m1:21[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m 3/17[0m [32mâ”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m1:15[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m 4/17[0m [32mâ”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m1:09[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m 5/17[0m [32mâ”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m1:03[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m 6/17[0m [32mâ”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m58s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000 [1m 7/17[0m [32mâ”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”[0m [1m52s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m 8/17[0m [32mâ”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”[0m [1m47s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m 9/17[0m [32mâ”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”[0m [1m41s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m10/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”[0m [1m36s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m11/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”[0m [1m31s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m12/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”â”[0m [1m26s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m13/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”[0m [1m20s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m14/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”[0m [1m15s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m15/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”[0m [1m10s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m16/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”[0m [1m5s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000 [1m17/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37m[0m [1m0s[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m17/17[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37m[0m [1m98s[0m 6s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000 - val_directional_accuracy_metric: 0.0000e+00 - val_loss: nan - val_mae: nan - val_r_squared_metric: -1.0000 - learning_rate: 4.8000e-06

Epoch 3: LearningRateScheduler setting learning rate to 6.5999999999999995e-06.
Epoch 3/30
[1m 1/17[0m [32mâ”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m1:23[0m 5s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m 2/17[0m [32mâ”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m1:24[0m 6s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m 3/17[0m [32mâ”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m1:17[0m 6s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m 4/17[0m [32mâ”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m1:12[0m 6s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000[1m 5/17[0m [32mâ”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m1:06[0m 6s/step - directional_accuracy_metric: 0.0000e+00 - loss: nan - mae: nan - r_squared_metric: -1.0000