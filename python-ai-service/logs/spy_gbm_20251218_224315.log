2025-12-18 22:43:17,898 - __main__ - INFO - Using seed: 42
2025-12-18 22:43:17,899 - __main__ - INFO - Preparing GBM data for SPY...
2025-12-18 22:43:17,899 - data.cache_manager - INFO - DataCacheManager initialized: cache
2025-12-18 22:43:17,900 - data.cache_manager - INFO - üìä Fetching fresh data for SPY...
2025-12-18 22:43:17,900 - data.cache_manager - INFO -   1/3 Fetching OHLCV data...
2025-12-18 22:43:17,900 - data.data_fetcher - INFO - Fetching data for SPY (period=max)
2025-12-18 22:43:18,480 - data.data_fetcher - INFO - ‚úì Fetched 8280 days of data for SPY
2025-12-18 22:43:18,480 - data.cache_manager - INFO -   2/3 Engineering features (sentiment=enabled)...
2025-12-18 22:48:09,519 - data.cache_manager - INFO - üì∞ Fetching fresh news for SPY...
2025-12-18 22:48:09,521 - data.news_fetcher - ERROR - finnhub-python library not found. Install with:
pip install finnhub-python>=2.4.0
2025-12-18 22:48:09,521 - data.cache_manager - ERROR - Failed to fetch news for SPY: No module named 'finnhub'
2025-12-18 22:48:09,523 - data.news_fetcher - ERROR - finnhub-python library not found. Install with:
pip install finnhub-python>=2.4.0
2025-12-18 22:48:09,523 - data.feature_engineer - WARNING - Direct news fetch failed for SPY: No module named 'finnhub'
/home/thunderboltdy/ai-stocks/python-ai-service/data/feature_engineer.py:1229: UserWarning: Feature engineering verified for look-ahead bias. All .shift() calls use positive or zero values. All .rolling() windows use past data only.
  warnings.warn(
2025-12-18 22:48:09,665 - data.feature_engineer - INFO - Cleaning features and handling NaN values (no look-ahead)...
2025-12-18 22:48:09,671 - data.feature_engineer - WARNING - Filling remaining NaNs with neutral values: {'returns': 1, 'log_returns': 1, 'volatility_5d': 5, 'volatility_20d': 20, 'rsi': 13, 'macd': 25, 'macd_signal': 33, 'macd_histogram': 33, 'stoch_k': 13, 'stoch_d': 15, 'sma_10': 9, 'sma_20': 19, 'sma_50': 49, 'price_to_sma20': 19, 'price_to_sma50': 49, 'sma_10_20_cross': 19, 'bb_upper': 19, 'bb_lower': 19, 'bb_width': 19, 'bb_position': 19, 'realized_vol_20d': 2, 'rv_iv_spread': 2, 'volume_sma': 19, 'volume_ratio': 19, 'momentum_1d': 1, 'momentum_5d': 5, 'momentum_20d': 20, 'rate_of_change_10d': 10, 'vol_ratio_5_20': 20, 'volume_price_trend': 19, 'accumulation_distribution': 38, 'return_lag_1': 2, 'return_lag_2': 3, 'return_lag_5': 6, 'velocity_5d': 5, 'velocity_10d': 10, 'velocity_20d': 20, 'acceleration_5d': 10, 'rsi_velocity': 18, 'volume_velocity': 5, 'gap_up': 1, 'gap_down': 1, 'rsi_momentum': 18, 'momentum_divergence_5d': 18, 'momentum_divergence_20d': 33, 'distance_to_fib_382': 20, 'distance_to_fib_500': 20, 'distance_to_fib_618': 20, 'vwap_deviation': 19, 'vwap_volume_ratio': 19, 'vwap_band_position': 19, 'vw_momentum_5d': 5, 'vw_momentum_20d': 20}
2025-12-18 22:48:09,696 - data.feature_engineer - INFO - [OK] All NaN values handled. Shape: (8280, 163)
2025-12-18 22:48:09,711 - data.feature_engineer - INFO - [AUDIT] Feature Audit for SPY:
2025-12-18 22:48:09,711 - data.feature_engineer - INFO -    Actual: 156 features
2025-12-18 22:48:09,711 - data.feature_engineer - INFO -    Expected: 147 features
2025-12-18 22:48:09,711 - data.feature_engineer - WARNING -    [WARN] Extra features (9): ['bb_position_high_vol', 'Capital Gains', 'volatility_regime_low', 'stoch_k_low_vol', 'stoch_k_high_vol', 'volatility_regime_high', 'regime_normal_vol', 'momentum_low_vol', 'momentum_high_vol']
2025-12-18 22:48:09,711 - data.feature_engineer - INFO -    Categories: {'price_momentum': 19, 'volatility': 42, 'volume': 21, 'trend': 18, 'pattern': 5, 'support_resistance': 11, 'sentiment': 17, 'regime': 13, 'divergence': 21, 'new_v31': 21}
2025-12-18 22:48:09,740 - data.feature_engineer - INFO - [OK] Feature engineering complete: (8280, 152) with EXACTLY 147 features
2025-12-18 22:48:09,740 - data.feature_engineer - INFO - [OK] Feature engineering complete: (8280, 152)
2025-12-18 22:48:09,748 - data.cache_manager - INFO -   3/3 Preparing training data...
2025-12-18 22:48:10,229 - data.cache_manager - INFO - üîç Validating data alignment...
2025-12-18 22:48:10,232 - data.cache_manager - INFO - ‚úì Sequence alignment validated (20 samples checked)
2025-12-18 22:48:10,232 - data.cache_manager - INFO - ‚úì Alignment validation passed
2025-12-18 22:48:10,232 - data.cache_manager - WARNING - Feature count mismatch in prepared data: expected=147, got=150
2025-12-18 22:48:10,232 - data.cache_manager - INFO -   Raw shape: (8280, 8)
2025-12-18 22:48:10,232 - data.cache_manager - INFO -   Engineered shape: (8280, 152)
2025-12-18 22:48:10,232 - data.cache_manager - INFO -   Prepared shape: (8278, 155)
2025-12-18 22:48:10,232 - data.cache_manager - INFO -   Index alignment: 8278 rows preserved from 8280
2025-12-18 22:48:10,256 - data.cache_manager - INFO - ‚úì Cached data for SPY: (8278, 155)
2025-12-18 22:48:10,256 - __main__ - INFO - Using cached data: (8278, 155)
2025-12-18 22:48:10,256 - __main__ - INFO - Found 14 sentiment features - ensure they are properly lagged
2025-12-18 22:48:10,256 - __main__ - INFO - ‚úì No look-ahead leakage detected in feature names
2025-12-18 22:48:10,258 - __main__ - INFO - Target range after clipping: [-0.1000, 0.1000]
2025-12-18 22:48:10,260 - __main__ - INFO - Data shape: X=(8278, 147), y=(8278,)
2025-12-18 22:48:10,260 - __main__ - INFO - 
============================================================
2025-12-18 22:48:10,260 - __main__ - INFO - Training XGBoost...
2025-12-18 22:48:10,260 - __main__ - INFO - ============================================================
2025-12-18 22:48:10,260 - __main__ - INFO - Walk-forward CV: 5 splits, test_size=60, gap=1
2025-12-18 22:48:10,260 - __main__ - INFO - Total samples: 8278, min train size: 1379
2025-12-18 22:48:10,261 - __main__ - INFO - 
--- Fold 1/5 ---
2025-12-18 22:48:10,261 - __main__ - INFO - Train: 7977 samples (indices 0-7976)
2025-12-18 22:48:10,261 - __main__ - INFO - Val: 60 samples (indices 7978-8037)
2025-12-18 22:48:10,851 - __main__ - INFO -   XGBoost early stopped at iteration 76
2025-12-18 22:48:10,853 - __main__ - WARNING -   ‚ö†Ô∏è Fold 1 VARIANCE COLLAPSE: pred_std=0.000261
2025-12-18 22:48:10,853 - __main__ - WARNING -   ‚ö†Ô∏è Fold 1 SEVERE BIAS: 95.0% positive
2025-12-18 22:48:10,854 - __main__ - INFO -   MSE: 0.000062, MAE: 0.005485, R¬≤: 0.0177
2025-12-18 22:48:10,854 - __main__ - INFO -   Direction Acc: 0.6333, IC: 0.3017
2025-12-18 22:48:10,854 - __main__ - INFO -   Prediction std: 0.000261
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:48:11,146 - __main__ - INFO - ‚úì Training curve saved: logs/xgb_training_curve_SPY_fold1.png
2025-12-18 22:48:11,146 - __main__ - INFO - 
--- Fold 2/5 ---
2025-12-18 22:48:11,146 - __main__ - INFO - Train: 8037 samples (indices 0-8036)
2025-12-18 22:48:11,146 - __main__ - INFO - Val: 60 samples (indices 8038-8097)
2025-12-18 22:48:14,283 - __main__ - INFO -   MSE: 0.000111, MAE: 0.008245, R¬≤: -0.0745
2025-12-18 22:48:14,283 - __main__ - INFO -   Direction Acc: 0.5500, IC: 0.0819
2025-12-18 22:48:14,283 - __main__ - INFO -   Prediction std: 0.002420
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:48:14,543 - __main__ - INFO - ‚úì Training curve saved: logs/xgb_training_curve_SPY_fold2.png
2025-12-18 22:48:14,543 - __main__ - INFO - 
--- Fold 3/5 ---
2025-12-18 22:48:14,543 - __main__ - INFO - Train: 8097 samples (indices 0-8096)
2025-12-18 22:48:14,543 - __main__ - INFO - Val: 60 samples (indices 8098-8157)
2025-12-18 22:48:17,585 - __main__ - INFO -   MSE: 0.000487, MAE: 0.013255, R¬≤: -0.1935
2025-12-18 22:48:17,585 - __main__ - INFO -   Direction Acc: 0.4000, IC: -0.0845
2025-12-18 22:48:17,585 - __main__ - INFO -   Prediction std: 0.006324
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:48:17,951 - __main__ - INFO - ‚úì Training curve saved: logs/xgb_training_curve_SPY_fold3.png
2025-12-18 22:48:17,951 - __main__ - INFO - 
--- Fold 4/5 ---
2025-12-18 22:48:17,951 - __main__ - INFO - Train: 8157 samples (indices 0-8156)
2025-12-18 22:48:17,951 - __main__ - INFO - Val: 60 samples (indices 8158-8217)
2025-12-18 22:48:20,905 - __main__ - INFO -   MSE: 0.000037, MAE: 0.004823, R¬≤: -0.2105
2025-12-18 22:48:20,905 - __main__ - INFO -   Direction Acc: 0.5167, IC: -0.0456
2025-12-18 22:48:20,905 - __main__ - INFO -   Prediction std: 0.001586
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:48:21,161 - __main__ - INFO - ‚úì Training curve saved: logs/xgb_training_curve_SPY_fold4.png
2025-12-18 22:48:21,162 - __main__ - INFO - 
--- Fold 5/5 ---
2025-12-18 22:48:21,162 - __main__ - INFO - Train: 8217 samples (indices 0-8216)
2025-12-18 22:48:21,162 - __main__ - INFO - Val: 60 samples (indices 8218-8277)
2025-12-18 22:48:24,423 - __main__ - INFO -   MSE: 0.000062, MAE: 0.005902, R¬≤: 0.0285
2025-12-18 22:48:24,423 - __main__ - INFO -   Direction Acc: 0.5500, IC: 0.1845
2025-12-18 22:48:24,423 - __main__ - INFO -   Prediction std: 0.002063
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:48:24,692 - __main__ - INFO - ‚úì Training curve saved: logs/xgb_training_curve_SPY_fold5.png
2025-12-18 22:48:24,695 - __main__ - WARNING - ‚ö†Ô∏è 1/5 folds have variance collapse (pred_std < 0.001)
2025-12-18 22:48:24,695 - __main__ - INFO - 
=== XGB CV Summary ===
2025-12-18 22:48:24,695 - __main__ - INFO - MSE: 0.000152 ¬± 0.000189
2025-12-18 22:48:24,695 - __main__ - INFO - MAE: 0.007542 ¬± 0.003444
2025-12-18 22:48:24,695 - __main__ - INFO - R¬≤: -0.0864 ¬± 0.1130
2025-12-18 22:48:24,695 - __main__ - INFO - Direction Acc: 0.5300 ¬± 0.0845
2025-12-18 22:48:24,695 - __main__ - INFO - IC: 0.0876 ¬± 0.1602
2025-12-18 22:48:24,695 - __main__ - INFO - Avg prediction std: 0.002531
2025-12-18 22:48:24,699 - __main__ - INFO - Training final XGB model on 8278 samples...
2025-12-18 22:48:24,901 - __main__ - INFO - Final XGBoost model: best iteration = 0
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:48:25,145 - __main__ - INFO - ‚úì Training curve saved: logs/xgb_training_curve_SPY_final.png
2025-12-18 22:48:25,147 - __main__ - INFO - Prediction stats: mean=0.000350, std=0.000125
2025-12-18 22:48:25,147 - __main__ - INFO - Prediction distribution: 98.9% positive, 1.1% negative
2025-12-18 22:48:25,147 - __main__ - INFO - Final IC: 0.2054, Direction Acc: 0.5459
2025-12-18 22:48:25,147 - __main__ - WARNING - ‚ö†Ô∏è VARIANCE COLLAPSE DETECTED: Predictions have near-zero variance
2025-12-18 22:48:25,147 - __main__ - WARNING -    This means the model is outputting constant values
2025-12-18 22:48:25,147 - __main__ - WARNING -    Root causes: early stopping too aggressive, huber_delta too large, or data issues
2025-12-18 22:48:25,147 - __main__ - WARNING - ‚ö†Ô∏è Predictions are biased: 98.9% positive, 1.1% negative
2025-12-18 22:48:25,166 - __main__ - INFO - XGBoost model saved to saved_models/SPY/gbm/xgb_reg.joblib
2025-12-18 22:48:25,166 - __main__ - INFO - 
============================================================
2025-12-18 22:48:25,166 - __main__ - INFO - Training LightGBM...
2025-12-18 22:48:25,166 - __main__ - INFO - ============================================================
2025-12-18 22:48:25,166 - __main__ - INFO - Walk-forward CV: 5 splits, test_size=60, gap=1
2025-12-18 22:48:25,166 - __main__ - INFO - Total samples: 8278, min train size: 1379
2025-12-18 22:48:25,166 - __main__ - INFO - 
--- Fold 1/5 ---
2025-12-18 22:48:25,166 - __main__ - INFO - Train: 7977 samples (indices 0-7976)
2025-12-18 22:48:25,166 - __main__ - INFO - Val: 60 samples (indices 7978-8037)
2025-12-18 22:48:25,745 - __main__ - INFO -   LightGBM trained 114 trees
/home/thunderboltdy/miniconda3/envs/ai-stocks/lib/python3.10/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
2025-12-18 22:48:25,747 - __main__ - INFO -   LightGBM Diagnostics (Fold 1):
2025-12-18 22:48:25,747 - __main__ - INFO -     Prediction std: 0.000470
2025-12-18 22:48:25,747 - __main__ - INFO -     Positive predictions: 96.7%
2025-12-18 22:48:25,747 - __main__ - INFO -     Mean prediction: 0.000341
2025-12-18 22:48:25,747 - __main__ - WARNING -   ‚ö†Ô∏è Fold 1 VARIANCE COLLAPSE: pred_std=0.000470
2025-12-18 22:48:25,747 - __main__ - ERROR -   Model may be over-regularized. Check reg_lambda and early_stopping.
2025-12-18 22:48:25,747 - __main__ - WARNING -   ‚ö†Ô∏è Fold 1 SEVERE BIAS: 96.7% positive
2025-12-18 22:48:25,749 - __main__ - INFO -   MSE: 0.000062, MAE: 0.005500, R¬≤: 0.0152
2025-12-18 22:48:25,749 - __main__ - INFO -   Direction Acc: 0.5833, IC: 0.1666
2025-12-18 22:48:25,749 - __main__ - INFO -   Prediction std: 0.000470
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:48:26,000 - __main__ - INFO - ‚úì Training curve saved: logs/lgb_training_curve_SPY_fold1.png
2025-12-18 22:48:26,000 - __main__ - INFO - 
--- Fold 2/5 ---
2025-12-18 22:48:26,000 - __main__ - INFO - Train: 8037 samples (indices 0-8036)
2025-12-18 22:48:26,000 - __main__ - INFO - Val: 60 samples (indices 8038-8097)
2025-12-18 22:48:30,273 - __main__ - INFO -   LightGBM trained 1000 trees
/home/thunderboltdy/miniconda3/envs/ai-stocks/lib/python3.10/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
2025-12-18 22:48:30,275 - __main__ - INFO -   LightGBM Diagnostics (Fold 2):
2025-12-18 22:48:30,275 - __main__ - INFO -     Prediction std: 0.002866
2025-12-18 22:48:30,275 - __main__ - INFO -     Positive predictions: 80.0%
2025-12-18 22:48:30,275 - __main__ - INFO -     Mean prediction: 0.001770
2025-12-18 22:48:30,276 - __main__ - INFO -   MSE: 0.000118, MAE: 0.008563, R¬≤: -0.1418
2025-12-18 22:48:30,276 - __main__ - INFO -   Direction Acc: 0.5167, IC: -0.0015
2025-12-18 22:48:30,276 - __main__ - INFO -   Prediction std: 0.002866
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:48:30,527 - __main__ - INFO - ‚úì Training curve saved: logs/lgb_training_curve_SPY_fold2.png
2025-12-18 22:48:30,527 - __main__ - INFO - 
--- Fold 3/5 ---
2025-12-18 22:48:30,527 - __main__ - INFO - Train: 8097 samples (indices 0-8096)
2025-12-18 22:48:30,527 - __main__ - INFO - Val: 60 samples (indices 8098-8157)
2025-12-18 22:48:33,886 - __main__ - INFO -   LightGBM trained 1000 trees
/home/thunderboltdy/miniconda3/envs/ai-stocks/lib/python3.10/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
2025-12-18 22:48:33,888 - __main__ - INFO -   LightGBM Diagnostics (Fold 3):
2025-12-18 22:48:33,888 - __main__ - INFO -     Prediction std: 0.007272
2025-12-18 22:48:33,888 - __main__ - INFO -     Positive predictions: 20.0%
2025-12-18 22:48:33,888 - __main__ - INFO -     Mean prediction: -0.004060
2025-12-18 22:48:33,889 - __main__ - INFO -   MSE: 0.000487, MAE: 0.014125, R¬≤: -0.1934
2025-12-18 22:48:33,889 - __main__ - INFO -   Direction Acc: 0.4500, IC: 0.0184
2025-12-18 22:48:33,889 - __main__ - INFO -   Prediction std: 0.007272
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:48:34,152 - __main__ - INFO - ‚úì Training curve saved: logs/lgb_training_curve_SPY_fold3.png
2025-12-18 22:48:34,152 - __main__ - INFO - 
--- Fold 4/5 ---
2025-12-18 22:48:34,152 - __main__ - INFO - Train: 8157 samples (indices 0-8156)
2025-12-18 22:48:34,152 - __main__ - INFO - Val: 60 samples (indices 8158-8217)
2025-12-18 22:48:37,729 - __main__ - INFO -   LightGBM trained 1000 trees
/home/thunderboltdy/miniconda3/envs/ai-stocks/lib/python3.10/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
2025-12-18 22:48:37,733 - __main__ - INFO -   LightGBM Diagnostics (Fold 4):
2025-12-18 22:48:37,733 - __main__ - INFO -     Prediction std: 0.001732
2025-12-18 22:48:37,733 - __main__ - INFO -     Positive predictions: 36.7%
2025-12-18 22:48:37,733 - __main__ - INFO -     Mean prediction: -0.000607
2025-12-18 22:48:37,734 - __main__ - INFO -   MSE: 0.000038, MAE: 0.004993, R¬≤: -0.2350
2025-12-18 22:48:37,734 - __main__ - INFO -   Direction Acc: 0.4000, IC: -0.0545
2025-12-18 22:48:37,734 - __main__ - INFO -   Prediction std: 0.001732
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:48:37,994 - __main__ - INFO - ‚úì Training curve saved: logs/lgb_training_curve_SPY_fold4.png
2025-12-18 22:48:37,995 - __main__ - INFO - 
--- Fold 5/5 ---
2025-12-18 22:48:37,995 - __main__ - INFO - Train: 8217 samples (indices 0-8216)
2025-12-18 22:48:37,995 - __main__ - INFO - Val: 60 samples (indices 8218-8277)
2025-12-18 22:48:40,991 - __main__ - INFO -   LightGBM trained 1000 trees
/home/thunderboltdy/miniconda3/envs/ai-stocks/lib/python3.10/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
2025-12-18 22:48:40,994 - __main__ - INFO -   LightGBM Diagnostics (Fold 5):
2025-12-18 22:48:40,994 - __main__ - INFO -     Prediction std: 0.002211
2025-12-18 22:48:40,994 - __main__ - INFO -     Positive predictions: 66.7%
2025-12-18 22:48:40,994 - __main__ - INFO -     Mean prediction: 0.001007
2025-12-18 22:48:40,996 - __main__ - INFO -   MSE: 0.000062, MAE: 0.005872, R¬≤: 0.0235
2025-12-18 22:48:40,996 - __main__ - INFO -   Direction Acc: 0.5000, IC: 0.1917
2025-12-18 22:48:40,996 - __main__ - INFO -   Prediction std: 0.002211
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:48:41,247 - __main__ - INFO - ‚úì Training curve saved: logs/lgb_training_curve_SPY_fold5.png
2025-12-18 22:48:41,250 - __main__ - WARNING - ‚ö†Ô∏è 1/5 folds have variance collapse (pred_std < 0.001)
2025-12-18 22:48:41,250 - __main__ - INFO - 
=== LGB CV Summary ===
2025-12-18 22:48:41,250 - __main__ - INFO - MSE: 0.000154 ¬± 0.000189
2025-12-18 22:48:41,250 - __main__ - INFO - MAE: 0.007811 ¬± 0.003791
2025-12-18 22:48:41,250 - __main__ - INFO - R¬≤: -0.1063 ¬± 0.1194
2025-12-18 22:48:41,250 - __main__ - INFO - Direction Acc: 0.4900 ¬± 0.0693
2025-12-18 22:48:41,250 - __main__ - INFO - IC: 0.0642 ¬± 0.1087
2025-12-18 22:48:41,250 - __main__ - INFO - Avg prediction std: 0.002910
2025-12-18 22:48:41,253 - __main__ - INFO - Training final LGB model on 8278 samples...
2025-12-18 22:48:41,706 - __main__ - INFO - Phase 1 complete: best_iter=1, using 200 trees for final model
2025-12-18 22:48:41,706 - __main__ - INFO - Phase 2 config: {'n_estimators': 200, 'learning_rate': 0.03, 'max_depth': 6, 'num_leaves': 31, 'subsample': 0.8, 'colsample_bytree': 0.8, 'min_child_samples': 20, 'reg_alpha': 0.005, 'reg_lambda': 0.01, 'min_split_gain': 0.0, 'random_state': 42, 'n_jobs': -1, 'objective': 'huber', 'alpha': 0.9, 'metric': ['rmse'], 'verbosity': -1, 'force_col_wise': True, 'deterministic': True}
2025-12-18 22:48:42,106 - __main__ - INFO - Phase 2 complete: Final LightGBM model trained 200 trees
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:48:42,360 - __main__ - INFO - ‚úì Training curve saved: logs/lgb_training_curve_SPY_final.png
/home/thunderboltdy/miniconda3/envs/ai-stocks/lib/python3.10/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
2025-12-18 22:48:42,369 - __main__ - INFO - Prediction stats: mean=0.000398, std=0.003492
2025-12-18 22:48:42,369 - __main__ - INFO - Prediction distribution: 78.2% positive, 21.8% negative
2025-12-18 22:48:42,369 - __main__ - INFO - Final IC: 0.6681, Direction Acc: 0.6340
2025-12-18 22:48:42,369 - __main__ - WARNING - ‚ö†Ô∏è Predictions are biased: 78.2% positive, 21.8% negative
2025-12-18 22:48:42,387 - __main__ - INFO - LightGBM model saved to saved_models/SPY/gbm/lgb_reg.joblib
2025-12-18 22:48:42,389 - __main__ - INFO - 
‚úì GBM training complete for SPY
2025-12-18 22:48:42,389 - __main__ - INFO -   Models saved to: saved_models/SPY/gbm
[INFO] Adding volatility spread features for SPY...
‚úì Fetched VIX data: 8279 days
‚úì Added volatility spread features (latest spread: -31.58%)
[OK] Volatility spread features added (5 new columns)
   Regime distribution - LOW: 4.00%, NORMAL: 86.15%, HIGH: 9.86%
   Current regime: NORMAL_VOL | Regime transitions/year: 8.80
   -> Preparing sentiment features (loads FinBERT + news data on first run, may take a few minutes)...

=== Fetching Sentiment Features for SPY ===
Fetching news from 1993-01-29 to 2025-12-18 (12071 days)...
[WARN] No news data available or fetch failed. Using zero-filled sentiment features.

=== Look-Ahead Bias Verification ===
Checking for common look-ahead patterns...
[OK] All shifts use positive or zero values (no negative shifts)
[OK] All rolling windows use past data only
[OK] Forward-looking features only in target labels (handled separately)

=== Feature Quality Check ===
[OK] No features with >5% NaN values
[OK] No inf values (successfully handled)

[WARN] Features with wide ranges (may need clipping):
   rsi: [28.7695, 78.1677] range=49.3982
   macd: [-7.5928, 7.0159] range=14.6087
   macd_signal: [-7.2509, 6.6838] range=13.9347
   stoch_k: [0.6816, 100.0000] range=99.3184
   stoch_d: [6.4310, 98.0428] range=91.6118
   ... and 19 more

Total features: 158
Total samples after cleaning: 8280
Technical features by category (expected sum): 116
Actual technical list length: 113
Difference from canonical 113: 0
Technical features by category (expected sum): 116
Actual technical list length: 113
Difference from canonical 113: 0

=== Feature Count Diagnostic ===
Expected features (count=147). Present feature cols (count=158).
Extra 11 features (will be dropped): ['Dividends', 'Stock Splits', 'Capital Gains', 'regime_normal_vol', 'bb_position_high_vol', 'stoch_k_low_vol', 'stoch_k_high_vol', 'momentum_low_vol', 'momentum_high_vol', 'volatility_regime_low', 'volatility_regime_high']
Dropped unexpected columns: ['Dividends', 'Stock Splits', 'Capital Gains', 'regime_normal_vol', 'bb_position_high_vol', 'stoch_k_low_vol', 'stoch_k_high_vol', 'momentum_low_vol', 'momentum_high_vol', 'volatility_regime_low', 'volatility_regime_high']
Final feature count after auto-fix: 147
Technical features by category (expected sum): 116
Actual technical list length: 113
Difference from canonical 113: 0
Technical features by category (expected sum): 116
Actual technical list length: 113
Difference from canonical 113: 0
‚úÖ Training data prepared:
   Total rows: 8278
   Features: 147
   Targets: ['target_1d']
   Lost rows (NaN): 2

=== Target Statistics (BEFORE clipping) ===
Range: [-0.1159, 0.1356]
Mean: 0.000401, Std: 0.011748
Percentiles: 1%=-0.0329, 99%=0.0318
P1.3: Winsorized 330 values (3.99%)
Clipped 0 values (0.00%)
\n=== Target Statistics (AFTER scaling) ===
Mean: 0.000000 (should be ~0)
Std: 1.000000 (should be ~1)
Range: [-2.69, 2.38]
Saved target engineering diagnostics to: data/target_engineering_comparison.png
Technical features by category (expected sum): 116
Actual technical list length: 113
Difference from canonical 113: 0
Training until validation scores don't improve for 100 rounds
[100]	training's rmse: 0.0106113	validation's rmse: 0.00790681
[200]	training's rmse: 0.009745	validation's rmse: 0.00792022
Early stopping, best iteration is:
[114]	training's rmse: 0.0104838	validation's rmse: 0.00788881
[100]	training's rmse: 0.0106197	validation's rmse: 0.0102114
[200]	training's rmse: 0.00974	validation's rmse: 0.0102711
[300]	training's rmse: 0.00900801	validation's rmse: 0.0103889
[400]	training's rmse: 0.00836193	validation's rmse: 0.0105655
[500]	training's rmse: 0.00776317	validation's rmse: 0.0106498
[600]	training's rmse: 0.00720509	validation's rmse: 0.0107977
[700]	training's rmse: 0.00672087	validation's rmse: 0.0108015
[800]	training's rmse: 0.00629662	validation's rmse: 0.010792
[900]	training's rmse: 0.00589392	validation's rmse: 0.0108165
[1000]	training's rmse: 0.00553671	validation's rmse: 0.0108428
[100]	training's rmse: 0.0106069	validation's rmse: 0.0216279
[200]	training's rmse: 0.00974118	validation's rmse: 0.0221778
[300]	training's rmse: 0.00898825	validation's rmse: 0.0220288
[400]	training's rmse: 0.00832668	validation's rmse: 0.0221964
[500]	training's rmse: 0.00771267	validation's rmse: 0.0220855
[600]	training's rmse: 0.00721003	validation's rmse: 0.022013
[700]	training's rmse: 0.00673304	validation's rmse: 0.0220399
[800]	training's rmse: 0.00631961	validation's rmse: 0.0219719
[900]	training's rmse: 0.00593552	validation's rmse: 0.02205
[1000]	training's rmse: 0.00557457	validation's rmse: 0.0220749
[100]	training's rmse: 0.0105418	validation's rmse: 0.0056169
[200]	training's rmse: 0.00966023	validation's rmse: 0.00564719
[300]	training's rmse: 0.00889978	validation's rmse: 0.00571951
[400]	training's rmse: 0.00826287	validation's rmse: 0.00582658
[500]	training's rmse: 0.00768291	validation's rmse: 0.00589145
[600]	training's rmse: 0.00716331	validation's rmse: 0.0059819
[700]	training's rmse: 0.00667874	validation's rmse: 0.00598301
[800]	training's rmse: 0.00626129	validation's rmse: 0.00600516
[900]	training's rmse: 0.00588576	validation's rmse: 0.00612299
[1000]	training's rmse: 0.005517	validation's rmse: 0.00616038
[100]	training's rmse: 0.0106041	validation's rmse: 0.00793682
[200]	training's rmse: 0.00972061	validation's rmse: 0.00783651
[300]	training's rmse: 0.00893254	validation's rmse: 0.00779962
[400]	training's rmse: 0.00826812	validation's rmse: 0.00776576
[500]	training's rmse: 0.00768511	validation's rmse: 0.00777546
[600]	training's rmse: 0.00716338	validation's rmse: 0.00781802
[700]	training's rmse: 0.00674132	validation's rmse: 0.00779818
[800]	training's rmse: 0.00631906	validation's rmse: 0.00781666
[900]	training's rmse: 0.00592746	validation's rmse: 0.00784256
[1000]	training's rmse: 0.00557613	validation's rmse: 0.00790285
Training until validation scores don't improve for 100 rounds
[100]	training's rmse: 0.0103085	validation's rmse: 0.0128949
Early stopping, best iteration is:
[1]	training's rmse: 0.0113913	validation's rmse: 0.0126468

============================================================
TRAINING SUMMARY
============================================================

XGB:
  MSE:  0.000152 ¬± 0.000189
  MAE:  0.007542 ¬± 0.003444
  R¬≤:   -0.0864 ¬± 0.1130
  Dir:  0.5300 ¬± 0.0845
  IC:   0.0876 ¬± 0.1602

LGB:
  MSE:  0.000154 ¬± 0.000189
  MAE:  0.007811 ¬± 0.003791
  R¬≤:   -0.1063 ¬± 0.1194
  Dir:  0.4900 ¬± 0.0693
  IC:   0.0642 ¬± 0.1087
