2025-12-18 22:37:40,379 - __main__ - INFO - Using seed: 42
2025-12-18 22:37:40,380 - __main__ - INFO - Preparing GBM data for TSLA...
2025-12-18 22:37:40,380 - data.cache_manager - INFO - DataCacheManager initialized: cache
2025-12-18 22:37:40,380 - data.cache_manager - INFO - ðŸ“Š Fetching fresh data for TSLA...
2025-12-18 22:37:40,380 - data.cache_manager - INFO -   1/3 Fetching OHLCV data...
2025-12-18 22:37:40,380 - data.data_fetcher - INFO - Fetching data for TSLA (period=max)
2025-12-18 22:37:40,748 - data.data_fetcher - INFO - âœ“ Fetched 3893 days of data for TSLA
2025-12-18 22:37:40,748 - data.cache_manager - INFO -   2/3 Engineering features (sentiment=enabled)...
2025-12-18 22:40:01,426 - data.cache_manager - INFO - ðŸ“° Fetching fresh news for TSLA...
2025-12-18 22:40:01,427 - data.news_fetcher - ERROR - finnhub-python library not found. Install with:
pip install finnhub-python>=2.4.0
2025-12-18 22:40:01,427 - data.cache_manager - ERROR - Failed to fetch news for TSLA: No module named 'finnhub'
2025-12-18 22:40:01,429 - data.news_fetcher - ERROR - finnhub-python library not found. Install with:
pip install finnhub-python>=2.4.0
2025-12-18 22:40:01,429 - data.feature_engineer - WARNING - Direct news fetch failed for TSLA: No module named 'finnhub'
/home/thunderboltdy/ai-stocks/python-ai-service/data/feature_engineer.py:1229: UserWarning: Feature engineering verified for look-ahead bias. All .shift() calls use positive or zero values. All .rolling() windows use past data only.
  warnings.warn(
2025-12-18 22:40:01,554 - data.feature_engineer - INFO - Cleaning features and handling NaN values (no look-ahead)...
2025-12-18 22:40:01,560 - data.feature_engineer - WARNING - Filling remaining NaNs with neutral values: {'returns': 1, 'log_returns': 1, 'volatility_5d': 5, 'volatility_20d': 20, 'rsi': 13, 'macd': 25, 'macd_signal': 33, 'macd_histogram': 33, 'stoch_k': 13, 'stoch_d': 15, 'sma_10': 9, 'sma_20': 19, 'sma_50': 49, 'price_to_sma20': 19, 'price_to_sma50': 49, 'sma_10_20_cross': 19, 'bb_upper': 19, 'bb_lower': 19, 'bb_width': 19, 'bb_position': 19, 'realized_vol_20d': 2, 'rv_iv_spread': 2, 'volume_sma': 19, 'volume_ratio': 19, 'momentum_1d': 1, 'momentum_5d': 5, 'momentum_20d': 20, 'rate_of_change_10d': 10, 'vol_ratio_5_20': 20, 'volume_price_trend': 19, 'accumulation_distribution': 38, 'return_lag_1': 2, 'return_lag_2': 3, 'return_lag_5': 6, 'velocity_5d': 5, 'velocity_10d': 10, 'velocity_20d': 20, 'acceleration_5d': 10, 'rsi_velocity': 18, 'volume_velocity': 5, 'gap_up': 1, 'gap_down': 1, 'rsi_momentum': 18, 'momentum_divergence_5d': 18, 'momentum_divergence_20d': 33, 'distance_to_fib_382': 20, 'distance_to_fib_500': 20, 'distance_to_fib_618': 20, 'vwap_deviation': 19, 'vwap_volume_ratio': 19, 'vwap_band_position': 19, 'vw_momentum_5d': 5, 'vw_momentum_20d': 20}
2025-12-18 22:40:01,586 - data.feature_engineer - INFO - [OK] All NaN values handled. Shape: (3893, 162)
2025-12-18 22:40:01,598 - data.feature_engineer - INFO - [AUDIT] Feature Audit for TSLA:
2025-12-18 22:40:01,598 - data.feature_engineer - INFO -    Actual: 155 features
2025-12-18 22:40:01,598 - data.feature_engineer - INFO -    Expected: 147 features
2025-12-18 22:40:01,598 - data.feature_engineer - WARNING -    [WARN] Extra features (8): ['stoch_k_high_vol', 'regime_normal_vol', 'stoch_k_low_vol', 'volatility_regime_high', 'momentum_high_vol', 'bb_position_high_vol', 'momentum_low_vol', 'volatility_regime_low']
2025-12-18 22:40:01,598 - data.feature_engineer - INFO -    Categories: {'price_momentum': 19, 'volatility': 42, 'volume': 21, 'trend': 18, 'pattern': 5, 'support_resistance': 11, 'sentiment': 17, 'regime': 13, 'divergence': 21, 'new_v31': 21}
2025-12-18 22:40:01,618 - data.feature_engineer - INFO - [OK] Feature engineering complete: (3893, 152) with EXACTLY 147 features
2025-12-18 22:40:01,618 - data.feature_engineer - INFO - [OK] Feature engineering complete: (3893, 152)
2025-12-18 22:40:01,621 - data.cache_manager - INFO -   3/3 Preparing training data...
2025-12-18 22:40:02,195 - data.cache_manager - INFO - ðŸ” Validating data alignment...
2025-12-18 22:40:02,198 - data.cache_manager - INFO - âœ“ Sequence alignment validated (20 samples checked)
2025-12-18 22:40:02,198 - data.cache_manager - INFO - âœ“ Alignment validation passed
2025-12-18 22:40:02,198 - data.cache_manager - WARNING - Feature count mismatch in prepared data: expected=147, got=150
2025-12-18 22:40:02,198 - data.cache_manager - INFO -   Raw shape: (3893, 7)
2025-12-18 22:40:02,198 - data.cache_manager - INFO -   Engineered shape: (3893, 152)
2025-12-18 22:40:02,198 - data.cache_manager - INFO -   Prepared shape: (3891, 155)
2025-12-18 22:40:02,198 - data.cache_manager - INFO -   Index alignment: 3891 rows preserved from 3893
2025-12-18 22:40:02,212 - data.cache_manager - INFO - âœ“ Cached data for TSLA: (3891, 155)
2025-12-18 22:40:02,212 - __main__ - INFO - Using cached data: (3891, 155)
2025-12-18 22:40:02,212 - __main__ - INFO - Found 14 sentiment features - ensure they are properly lagged
2025-12-18 22:40:02,212 - __main__ - INFO - âœ“ No look-ahead leakage detected in feature names
2025-12-18 22:40:02,214 - __main__ - INFO - Target range after clipping: [-0.1000, 0.1000]
2025-12-18 22:40:02,216 - __main__ - INFO - Data shape: X=(3891, 147), y=(3891,)
2025-12-18 22:40:02,216 - __main__ - INFO - 
============================================================
2025-12-18 22:40:02,216 - __main__ - INFO - Training XGBoost...
2025-12-18 22:40:02,216 - __main__ - INFO - ============================================================
2025-12-18 22:40:02,216 - __main__ - INFO - Walk-forward CV: 5 splits, test_size=60, gap=1
2025-12-18 22:40:02,216 - __main__ - INFO - Total samples: 3891, min train size: 648
2025-12-18 22:40:02,216 - __main__ - INFO - 
--- Fold 1/5 ---
2025-12-18 22:40:02,216 - __main__ - INFO - Train: 3590 samples (indices 0-3589)
2025-12-18 22:40:02,216 - __main__ - INFO - Val: 60 samples (indices 3591-3650)
2025-12-18 22:40:02,612 - __main__ - INFO -   XGBoost early stopped at iteration 8
2025-12-18 22:40:02,614 - __main__ - WARNING -   âš ï¸ Fold 1 SEVERE BIAS: 96.7% positive
2025-12-18 22:40:02,615 - __main__ - INFO -   MSE: 0.001739, MAE: 0.032605, RÂ²: -0.0080
2025-12-18 22:40:02,615 - __main__ - INFO -   Direction Acc: 0.4833, IC: -0.0003
2025-12-18 22:40:02,615 - __main__ - INFO -   Prediction std: 0.001435
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:40:02,881 - __main__ - INFO - âœ“ Training curve saved: logs/xgb_training_curve_TSLA_fold1.png
2025-12-18 22:40:02,881 - __main__ - INFO - 
--- Fold 2/5 ---
2025-12-18 22:40:02,881 - __main__ - INFO - Train: 3650 samples (indices 0-3649)
2025-12-18 22:40:02,881 - __main__ - INFO - Val: 60 samples (indices 3651-3710)
2025-12-18 22:40:06,489 - __main__ - INFO -   MSE: 0.001715, MAE: 0.033233, RÂ²: -0.0128
2025-12-18 22:40:06,489 - __main__ - INFO -   Direction Acc: 0.5667, IC: 0.1908
2025-12-18 22:40:06,489 - __main__ - INFO -   Prediction std: 0.014765
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:40:06,759 - __main__ - INFO - âœ“ Training curve saved: logs/xgb_training_curve_TSLA_fold2.png
2025-12-18 22:40:06,760 - __main__ - INFO - 
--- Fold 3/5 ---
2025-12-18 22:40:06,760 - __main__ - INFO - Train: 3710 samples (indices 0-3709)
2025-12-18 22:40:06,760 - __main__ - INFO - Val: 60 samples (indices 3711-3770)
2025-12-18 22:40:10,207 - __main__ - INFO -   MSE: 0.002040, MAE: 0.035978, RÂ²: -0.1446
2025-12-18 22:40:10,207 - __main__ - INFO -   Direction Acc: 0.4833, IC: -0.0239
2025-12-18 22:40:10,207 - __main__ - INFO -   Prediction std: 0.014838
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:40:10,471 - __main__ - INFO - âœ“ Training curve saved: logs/xgb_training_curve_TSLA_fold3.png
2025-12-18 22:40:10,471 - __main__ - INFO - 
--- Fold 4/5 ---
2025-12-18 22:40:10,471 - __main__ - INFO - Train: 3770 samples (indices 0-3769)
2025-12-18 22:40:10,471 - __main__ - INFO - Val: 60 samples (indices 3771-3830)
2025-12-18 22:40:13,557 - __main__ - INFO -   MSE: 0.000971, MAE: 0.023293, RÂ²: -0.1613
2025-12-18 22:40:13,558 - __main__ - INFO -   Direction Acc: 0.5000, IC: -0.0719
2025-12-18 22:40:13,558 - __main__ - INFO -   Prediction std: 0.009652
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:40:13,831 - __main__ - INFO - âœ“ Training curve saved: logs/xgb_training_curve_TSLA_fold4.png
2025-12-18 22:40:13,831 - __main__ - INFO - 
--- Fold 5/5 ---
2025-12-18 22:40:13,831 - __main__ - INFO - Train: 3830 samples (indices 0-3829)
2025-12-18 22:40:13,831 - __main__ - INFO - Val: 60 samples (indices 3831-3890)
2025-12-18 22:40:17,051 - __main__ - INFO -   MSE: 0.001138, MAE: 0.027442, RÂ²: -0.1296
2025-12-18 22:40:17,051 - __main__ - INFO -   Direction Acc: 0.4500, IC: -0.0149
2025-12-18 22:40:17,051 - __main__ - INFO -   Prediction std: 0.010784
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:40:17,334 - __main__ - INFO - âœ“ Training curve saved: logs/xgb_training_curve_TSLA_fold5.png
2025-12-18 22:40:17,336 - __main__ - INFO - 
=== XGB CV Summary ===
2025-12-18 22:40:17,336 - __main__ - INFO - MSE: 0.001520 Â± 0.000448
2025-12-18 22:40:17,336 - __main__ - INFO - MAE: 0.030510 Â± 0.005079
2025-12-18 22:40:17,336 - __main__ - INFO - RÂ²: -0.0913 Â± 0.0747
2025-12-18 22:40:17,337 - __main__ - INFO - Direction Acc: 0.4967 Â± 0.0431
2025-12-18 22:40:17,337 - __main__ - INFO - IC: 0.0159 Â± 0.1013
2025-12-18 22:40:17,337 - __main__ - INFO - Avg prediction std: 0.010295
2025-12-18 22:40:17,338 - __main__ - INFO - Training final XGB model on 3891 samples...
2025-12-18 22:40:17,516 - __main__ - INFO - Final XGBoost model: best iteration = 0
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:40:17,795 - __main__ - INFO - âœ“ Training curve saved: logs/xgb_training_curve_TSLA_final.png
2025-12-18 22:40:17,797 - __main__ - INFO - Prediction stats: mean=0.001487, std=0.000234
2025-12-18 22:40:17,797 - __main__ - INFO - Prediction distribution: 99.8% positive, 0.2% negative
2025-12-18 22:40:17,797 - __main__ - INFO - Final IC: 0.1714, Direction Acc: 0.5189
2025-12-18 22:40:17,797 - __main__ - WARNING - âš ï¸ VARIANCE COLLAPSE DETECTED: Predictions have near-zero variance
2025-12-18 22:40:17,797 - __main__ - WARNING -    This means the model is outputting constant values
2025-12-18 22:40:17,798 - __main__ - WARNING -    Root causes: early stopping too aggressive, huber_delta too large, or data issues
2025-12-18 22:40:17,798 - __main__ - WARNING - âš ï¸ Predictions are biased: 99.8% positive, 0.2% negative
2025-12-18 22:40:17,810 - __main__ - INFO - XGBoost model saved to saved_models/TSLA/gbm/xgb_reg.joblib
2025-12-18 22:40:17,810 - __main__ - INFO - 
============================================================
2025-12-18 22:40:17,810 - __main__ - INFO - Training LightGBM...
2025-12-18 22:40:17,810 - __main__ - INFO - ============================================================
2025-12-18 22:40:17,810 - __main__ - INFO - Walk-forward CV: 5 splits, test_size=60, gap=1
2025-12-18 22:40:17,810 - __main__ - INFO - Total samples: 3891, min train size: 648
2025-12-18 22:40:17,810 - __main__ - INFO - 
--- Fold 1/5 ---
2025-12-18 22:40:17,810 - __main__ - INFO - Train: 3590 samples (indices 0-3589)
2025-12-18 22:40:17,810 - __main__ - INFO - Val: 60 samples (indices 3591-3650)
2025-12-18 22:40:22,942 - __main__ - INFO -   LightGBM trained 118 trees
/home/thunderboltdy/miniconda3/envs/ai-stocks/lib/python3.10/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
2025-12-18 22:40:22,944 - __main__ - INFO -   LightGBM Diagnostics (Fold 1):
2025-12-18 22:40:22,944 - __main__ - INFO -     Prediction std: 0.008724
2025-12-18 22:40:22,944 - __main__ - INFO -     Positive predictions: 63.3%
2025-12-18 22:40:22,944 - __main__ - INFO -     Mean prediction: 0.003698
2025-12-18 22:40:22,946 - __main__ - INFO -   MSE: 0.001671, MAE: 0.032750, RÂ²: 0.0310
2025-12-18 22:40:22,946 - __main__ - INFO -   Direction Acc: 0.5833, IC: 0.1823
2025-12-18 22:40:22,946 - __main__ - INFO -   Prediction std: 0.008724
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:40:23,191 - __main__ - INFO - âœ“ Training curve saved: logs/lgb_training_curve_TSLA_fold1.png
2025-12-18 22:40:23,192 - __main__ - INFO - 
--- Fold 2/5 ---
2025-12-18 22:40:23,192 - __main__ - INFO - Train: 3650 samples (indices 0-3649)
2025-12-18 22:40:23,192 - __main__ - INFO - Val: 60 samples (indices 3651-3710)
2025-12-18 22:40:31,151 - __main__ - INFO -   LightGBM trained 1000 trees
/home/thunderboltdy/miniconda3/envs/ai-stocks/lib/python3.10/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
2025-12-18 22:40:31,153 - __main__ - INFO -   LightGBM Diagnostics (Fold 2):
2025-12-18 22:40:31,153 - __main__ - INFO -     Prediction std: 0.016933
2025-12-18 22:40:31,153 - __main__ - INFO -     Positive predictions: 46.7%
2025-12-18 22:40:31,153 - __main__ - INFO -     Mean prediction: -0.000523
2025-12-18 22:40:31,154 - __main__ - INFO -   MSE: 0.001959, MAE: 0.035857, RÂ²: -0.1575
2025-12-18 22:40:31,154 - __main__ - INFO -   Direction Acc: 0.5167, IC: 0.0278
2025-12-18 22:40:31,154 - __main__ - INFO -   Prediction std: 0.016933
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:40:31,402 - __main__ - INFO - âœ“ Training curve saved: logs/lgb_training_curve_TSLA_fold2.png
2025-12-18 22:40:31,402 - __main__ - INFO - 
--- Fold 3/5 ---
2025-12-18 22:40:31,402 - __main__ - INFO - Train: 3710 samples (indices 0-3709)
2025-12-18 22:40:31,402 - __main__ - INFO - Val: 60 samples (indices 3711-3770)
2025-12-18 22:40:34,324 - __main__ - INFO -   LightGBM trained 1000 trees
/home/thunderboltdy/miniconda3/envs/ai-stocks/lib/python3.10/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
2025-12-18 22:40:34,326 - __main__ - INFO -   LightGBM Diagnostics (Fold 3):
2025-12-18 22:40:34,326 - __main__ - INFO -     Prediction std: 0.018349
2025-12-18 22:40:34,326 - __main__ - INFO -     Positive predictions: 40.0%
2025-12-18 22:40:34,326 - __main__ - INFO -     Mean prediction: -0.002928
2025-12-18 22:40:34,327 - __main__ - INFO -   MSE: 0.002196, MAE: 0.037189, RÂ²: -0.2324
2025-12-18 22:40:34,327 - __main__ - INFO -   Direction Acc: 0.4333, IC: -0.0315
2025-12-18 22:40:34,327 - __main__ - INFO -   Prediction std: 0.018349
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:40:34,589 - __main__ - INFO - âœ“ Training curve saved: logs/lgb_training_curve_TSLA_fold3.png
2025-12-18 22:40:34,590 - __main__ - INFO - 
--- Fold 4/5 ---
2025-12-18 22:40:34,590 - __main__ - INFO - Train: 3770 samples (indices 0-3769)
2025-12-18 22:40:34,590 - __main__ - INFO - Val: 60 samples (indices 3771-3830)
2025-12-18 22:40:37,475 - __main__ - INFO -   LightGBM trained 1000 trees
/home/thunderboltdy/miniconda3/envs/ai-stocks/lib/python3.10/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
2025-12-18 22:40:37,477 - __main__ - INFO -   LightGBM Diagnostics (Fold 4):
2025-12-18 22:40:37,477 - __main__ - INFO -     Prediction std: 0.011214
2025-12-18 22:40:37,477 - __main__ - INFO -     Positive predictions: 56.7%
2025-12-18 22:40:37,477 - __main__ - INFO -     Mean prediction: 0.001958
2025-12-18 22:40:37,479 - __main__ - INFO -   MSE: 0.000985, MAE: 0.023404, RÂ²: -0.1776
2025-12-18 22:40:37,479 - __main__ - INFO -   Direction Acc: 0.5167, IC: -0.0245
2025-12-18 22:40:37,479 - __main__ - INFO -   Prediction std: 0.011214
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:40:37,717 - __main__ - INFO - âœ“ Training curve saved: logs/lgb_training_curve_TSLA_fold4.png
2025-12-18 22:40:37,718 - __main__ - INFO - 
--- Fold 5/5 ---
2025-12-18 22:40:37,718 - __main__ - INFO - Train: 3830 samples (indices 0-3829)
2025-12-18 22:40:37,718 - __main__ - INFO - Val: 60 samples (indices 3831-3890)
2025-12-18 22:40:43,247 - __main__ - INFO -   LightGBM trained 1000 trees
/home/thunderboltdy/miniconda3/envs/ai-stocks/lib/python3.10/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
2025-12-18 22:40:43,250 - __main__ - INFO -   LightGBM Diagnostics (Fold 5):
2025-12-18 22:40:43,250 - __main__ - INFO -     Prediction std: 0.009755
2025-12-18 22:40:43,250 - __main__ - INFO -     Positive predictions: 45.0%
2025-12-18 22:40:43,250 - __main__ - INFO -     Mean prediction: -0.001313
2025-12-18 22:40:43,251 - __main__ - INFO -   MSE: 0.001122, MAE: 0.027625, RÂ²: -0.1137
2025-12-18 22:40:43,252 - __main__ - INFO -   Direction Acc: 0.5167, IC: -0.0123
2025-12-18 22:40:43,252 - __main__ - INFO -   Prediction std: 0.009755
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:40:43,483 - __main__ - INFO - âœ“ Training curve saved: logs/lgb_training_curve_TSLA_fold5.png
2025-12-18 22:40:43,485 - __main__ - INFO - 
=== LGB CV Summary ===
2025-12-18 22:40:43,485 - __main__ - INFO - MSE: 0.001587 Â± 0.000523
2025-12-18 22:40:43,485 - __main__ - INFO - MAE: 0.031365 Â± 0.005775
2025-12-18 22:40:43,485 - __main__ - INFO - RÂ²: -0.1300 Â± 0.0996
2025-12-18 22:40:43,485 - __main__ - INFO - Direction Acc: 0.5133 Â± 0.0532
2025-12-18 22:40:43,485 - __main__ - INFO - IC: 0.0284 Â± 0.0891
2025-12-18 22:40:43,485 - __main__ - INFO - Avg prediction std: 0.012995
2025-12-18 22:40:43,486 - __main__ - INFO - Training final LGB model on 3891 samples...
2025-12-18 22:40:43,844 - __main__ - INFO - Phase 1 complete: best_iter=13, using 200 trees for final model
2025-12-18 22:40:43,844 - __main__ - INFO - Phase 2 config: {'n_estimators': 200, 'learning_rate': 0.03, 'max_depth': 6, 'num_leaves': 31, 'subsample': 0.8, 'colsample_bytree': 0.8, 'min_child_samples': 20, 'reg_alpha': 0.005, 'reg_lambda': 0.01, 'min_split_gain': 0.0, 'random_state': 42, 'n_jobs': -1, 'objective': 'huber', 'alpha': 0.9, 'metric': ['rmse'], 'verbosity': -1, 'force_col_wise': True, 'deterministic': True}
2025-12-18 22:40:44,159 - __main__ - INFO - Phase 2 complete: Final LightGBM model trained 200 trees
/home/thunderboltdy/ai-stocks/python-ai-service/training/train_gbm_baseline.py:191: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
  axes[1].legend()
2025-12-18 22:40:44,397 - __main__ - INFO - âœ“ Training curve saved: logs/lgb_training_curve_TSLA_final.png
/home/thunderboltdy/miniconda3/envs/ai-stocks/lib/python3.10/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
2025-12-18 22:40:44,403 - __main__ - INFO - Prediction stats: mean=0.001415, std=0.010699
2025-12-18 22:40:44,403 - __main__ - INFO - Prediction distribution: 55.3% positive, 44.7% negative
2025-12-18 22:40:44,403 - __main__ - INFO - Final IC: 0.7971, Direction Acc: 0.7731
2025-12-18 22:40:44,416 - __main__ - INFO - LightGBM model saved to saved_models/TSLA/gbm/lgb_reg.joblib
2025-12-18 22:40:44,418 - __main__ - INFO - 
âœ“ GBM training complete for TSLA
2025-12-18 22:40:44,418 - __main__ - INFO -   Models saved to: saved_models/TSLA/gbm
[INFO] Adding volatility spread features for TSLA...
âœ“ Fetched VIX data: 3893 days
âœ“ Added volatility spread features (latest spread: 155.51%)
[OK] Volatility spread features added (5 new columns)
   Regime distribution - LOW: 3.03%, NORMAL: 87.82%, HIGH: 9.14%
   Current regime: NORMAL_VOL | Regime transitions/year: 10.55
   -> Preparing sentiment features (loads FinBERT + news data on first run, may take a few minutes)...

=== Fetching Sentiment Features for TSLA ===
Fetching news from 2010-06-29 to 2025-12-18 (5711 days)...
[WARN] No news data available or fetch failed. Using zero-filled sentiment features.

=== Look-Ahead Bias Verification ===
Checking for common look-ahead patterns...
[OK] All shifts use positive or zero values (no negative shifts)
[OK] All rolling windows use past data only
[OK] Forward-looking features only in target labels (handled separately)

=== Feature Quality Check ===
[OK] No features with >5% NaN values
[OK] No inf values (successfully handled)

[WARN] Features with wide ranges (may need clipping):
   rsi: [25.9768, 83.9355] range=57.9587
   macd: [-19.1088, 25.0274] range=44.1363
   macd_signal: [-17.7407, 23.8083] range=41.5491
   macd_histogram: [-6.5668, 7.2640] range=13.8308
   stoch_k: [1.3295, 99.4980] range=98.1685
   ... and 22 more

Total features: 157
Total samples after cleaning: 3893
Technical features by category (expected sum): 116
Actual technical list length: 113
Difference from canonical 113: 0
Technical features by category (expected sum): 116
Actual technical list length: 113
Difference from canonical 113: 0

=== Feature Count Diagnostic ===
Expected features (count=147). Present feature cols (count=157).
Extra 10 features (will be dropped): ['Dividends', 'Stock Splits', 'regime_normal_vol', 'bb_position_high_vol', 'stoch_k_low_vol', 'stoch_k_high_vol', 'momentum_low_vol', 'momentum_high_vol', 'volatility_regime_low', 'volatility_regime_high']
Dropped unexpected columns: ['Dividends', 'Stock Splits', 'regime_normal_vol', 'bb_position_high_vol', 'stoch_k_low_vol', 'stoch_k_high_vol', 'momentum_low_vol', 'momentum_high_vol', 'volatility_regime_low', 'volatility_regime_high']
Final feature count after auto-fix: 147
Technical features by category (expected sum): 116
Actual technical list length: 113
Difference from canonical 113: 0
Technical features by category (expected sum): 116
Actual technical list length: 113
Difference from canonical 113: 0
âœ… Training data prepared:
   Total rows: 3891
   Features: 147
   Targets: ['target_1d']
   Lost rows (NaN): 2

=== Target Statistics (BEFORE clipping) ===
Range: [-0.2365, 0.2183]
Mean: 0.001470, Std: 0.036279
Percentiles: 1%=-0.0946, 99%=0.1043
P1.3: Winsorized 154 values (3.96%)
Clipped 0 values (0.00%)
\n=== Target Statistics (AFTER scaling) ===
Mean: 0.000000 (should be ~0)
Std: 1.000000 (should be ~1)
Range: [-2.49, 2.53]
Saved target engineering diagnostics to: data/target_engineering_comparison.png
Technical features by category (expected sum): 116
Actual technical list length: 113
Difference from canonical 113: 0
Training until validation scores don't improve for 100 rounds
[100]	training's rmse: 0.0281926	validation's rmse: 0.0411101
[200]	training's rmse: 0.0249326	validation's rmse: 0.0414341
Early stopping, best iteration is:
[118]	training's rmse: 0.0275792	validation's rmse: 0.0408827
[100]	training's rmse: 0.0283036	validation's rmse: 0.0411155
[200]	training's rmse: 0.0249863	validation's rmse: 0.0409912
[300]	training's rmse: 0.0222168	validation's rmse: 0.0412727
[400]	training's rmse: 0.0199006	validation's rmse: 0.0418657
[500]	training's rmse: 0.0177408	validation's rmse: 0.0423986
[600]	training's rmse: 0.0158125	validation's rmse: 0.042634
[700]	training's rmse: 0.0142407	validation's rmse: 0.0431105
[800]	training's rmse: 0.0128059	validation's rmse: 0.0436436
[900]	training's rmse: 0.011481	validation's rmse: 0.0440383
[1000]	training's rmse: 0.0103568	validation's rmse: 0.044266
[100]	training's rmse: 0.0283339	validation's rmse: 0.0432174
[200]	training's rmse: 0.0252863	validation's rmse: 0.0442113
[300]	training's rmse: 0.0225108	validation's rmse: 0.04484
[400]	training's rmse: 0.0202574	validation's rmse: 0.0452007
[500]	training's rmse: 0.0181698	validation's rmse: 0.0451852
[600]	training's rmse: 0.0161433	validation's rmse: 0.0456686
[700]	training's rmse: 0.0145555	validation's rmse: 0.0459083
[800]	training's rmse: 0.0129855	validation's rmse: 0.0461812
[900]	training's rmse: 0.0117003	validation's rmse: 0.0464652
[1000]	training's rmse: 0.010563	validation's rmse: 0.0468657
[100]	training's rmse: 0.0284882	validation's rmse: 0.0299627
[200]	training's rmse: 0.0255472	validation's rmse: 0.0305335
[300]	training's rmse: 0.0231397	validation's rmse: 0.0307419
[400]	training's rmse: 0.0205957	validation's rmse: 0.0307013
[500]	training's rmse: 0.01836	validation's rmse: 0.0308303
[600]	training's rmse: 0.0164115	validation's rmse: 0.0308693
[700]	training's rmse: 0.0149089	validation's rmse: 0.0310704
[800]	training's rmse: 0.0134082	validation's rmse: 0.0311175
[900]	training's rmse: 0.0121321	validation's rmse: 0.0313427
[1000]	training's rmse: 0.0109267	validation's rmse: 0.0313843
[100]	training's rmse: 0.0287043	validation's rmse: 0.0324372
[200]	training's rmse: 0.0255036	validation's rmse: 0.0325462
[300]	training's rmse: 0.0228929	validation's rmse: 0.0324014
[400]	training's rmse: 0.0207022	validation's rmse: 0.0326663
[500]	training's rmse: 0.0186857	validation's rmse: 0.0330177
[600]	training's rmse: 0.0167699	validation's rmse: 0.0333251
[700]	training's rmse: 0.0149929	validation's rmse: 0.0333145
[800]	training's rmse: 0.0135071	validation's rmse: 0.0333937
[900]	training's rmse: 0.0121377	validation's rmse: 0.0334107
[1000]	training's rmse: 0.0108974	validation's rmse: 0.0334931
Training until validation scores don't improve for 100 rounds
[100]	training's rmse: 0.0280723	validation's rmse: 0.0364932
Early stopping, best iteration is:
[13]	training's rmse: 0.0314641	validation's rmse: 0.0359904

============================================================
TRAINING SUMMARY
============================================================

XGB:
  MSE:  0.001520 Â± 0.000448
  MAE:  0.030510 Â± 0.005079
  RÂ²:   -0.0913 Â± 0.0747
  Dir:  0.4967 Â± 0.0431
  IC:   0.0159 Â± 0.1013

LGB:
  MSE:  0.001587 Â± 0.000523
  MAE:  0.031365 Â± 0.005775
  RÂ²:   -0.1300 Â± 0.0996
  Dir:  0.5133 Â± 0.0532
  IC:   0.0284 Â± 0.0891
