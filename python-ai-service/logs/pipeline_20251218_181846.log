2025-12-18 18:18:46,339 - __main__ - INFO - ======================================================================
2025-12-18 18:18:46,339 - __main__ - INFO - STARTING COMPLETE TRAINING & BACKTESTING PIPELINE
2025-12-18 18:18:46,339 - __main__ - INFO - Symbols: AAPL
2025-12-18 18:18:46,339 - __main__ - INFO - Epochs: 5
2025-12-18 18:18:46,340 - __main__ - INFO - Batch Size: 256
2025-12-18 18:18:46,340 - __main__ - INFO - ======================================================================
2025-12-18 18:18:46,340 - __main__ - INFO - 


2025-12-18 18:18:46,340 - __main__ - INFO - ######################################################################
2025-12-18 18:18:46,340 - __main__ - INFO - # PROCESSING: AAPL
2025-12-18 18:18:46,340 - __main__ - INFO - ######################################################################
2025-12-18 18:18:46,340 - __main__ - INFO - ======================================================================
2025-12-18 18:18:46,340 - __main__ - INFO - PHASE 1: DATA PREPARATION - AAPL
2025-12-18 18:18:46,340 - __main__ - INFO - ======================================================================
2025-12-18 18:18:46,944 - __main__ - INFO - Fetching raw data for AAPL...
2025-12-18 18:18:46,944 - data.data_fetcher - INFO - Fetching data for AAPL (period=max)
2025-12-18 18:18:47,594 - data.data_fetcher - INFO - ✓ Fetched 11347 days of data for AAPL
2025-12-18 18:18:47,594 - __main__ - INFO - ✓ Fetched 11347 rows of OHLCV data
2025-12-18 18:18:47,594 - __main__ - INFO - Engineering features for AAPL...
2025-12-18 18:25:08,108 - data.feature_engineer - INFO - Cleaning features and handling NaN values (no look-ahead)...
2025-12-18 18:25:08,125 - data.feature_engineer - WARNING - Filling remaining NaNs with neutral values: {'returns': 1, 'log_returns': 1, 'volatility_5d': 5, 'volatility_20d': 20, 'rsi': 13, 'macd': 25, 'macd_signal': 33, 'macd_histogram': 33, 'stoch_k': 13, 'stoch_d': 15, 'sma_10': 9, 'sma_20': 19, 'sma_50': 49, 'price_to_sma20': 19, 'price_to_sma50': 49, 'sma_10_20_cross': 19, 'bb_upper': 19, 'bb_lower': 19, 'bb_width': 19, 'bb_position': 19, 'vix': 2288, 'realized_vol_20d': 2, 'rv_iv_spread': 2288, 'volume_sma': 19, 'volume_ratio': 19, 'momentum_1d': 1, 'momentum_5d': 5, 'momentum_20d': 20, 'rate_of_change_10d': 10, 'vol_ratio_5_20': 20, 'volume_price_trend': 19, 'accumulation_distribution': 38, 'return_lag_1': 2, 'return_lag_2': 3, 'return_lag_5': 6, 'velocity_5d': 5, 'velocity_10d': 10, 'velocity_20d': 20, 'acceleration_5d': 10, 'rsi_velocity': 18, 'volume_velocity': 6, 'gap_up': 1, 'gap_down': 1, 'rsi_momentum': 18, 'momentum_divergence_5d': 18, 'momentum_divergence_20d': 33, 'distance_to_fib_382': 20, 'distance_to_fib_500': 20, 'distance_to_fib_618': 20, 'vwap_deviation': 19, 'vwap_volume_ratio': 19, 'vwap_band_position': 19, 'vw_momentum_5d': 5, 'vw_momentum_20d': 20}
2025-12-18 18:25:08,196 - data.feature_engineer - INFO - [OK] All NaN values handled. Shape: (11347, 128)
2025-12-18 18:25:08,230 - data.feature_engineer - INFO - [AUDIT] Feature Audit for AAPL:
2025-12-18 18:25:08,230 - data.feature_engineer - INFO -    Actual: 121 features
2025-12-18 18:25:08,230 - data.feature_engineer - INFO -    Expected: 113 features
2025-12-18 18:25:08,230 - data.feature_engineer - WARNING -    [WARN] Extra features (8): ['stoch_k_low_vol', 'volatility_regime_low', 'stoch_k_high_vol', 'momentum_high_vol', 'volatility_regime_high', 'regime_normal_vol', 'momentum_low_vol', 'bb_position_high_vol']
2025-12-18 18:25:08,230 - data.feature_engineer - INFO -    Categories: {'price_momentum': 16, 'volatility': 35, 'volume': 15, 'trend': 16, 'pattern': 5, 'support_resistance': 11, 'sentiment': 0, 'regime': 9, 'divergence': 19, 'new_v31': 21}
2025-12-18 18:25:08,290 - data.feature_engineer - WARNING - validate_feature_count() failed: CRITICAL: Final feature count is 113, expected 147!
Columns: ['Open', 'High', 'Low', 'Close', 'Volume', 'returns', 'log_returns', 'volatility_5d', 'volatility_20d', 'rsi', 'macd', 'macd_signal', 'macd_histogram', 'stoch_k', 'stoch_d', 'sma_10', 'sma_20', 'sma_50', 'ema_12', 'ema_26', 'price_to_sma20', 'price_to_sma50', 'sma_10_20_cross', 'ema_12_26_cross', 'bb_upper', 'bb_lower', 'bb_width', 'bb_position', 'atr', 'atr_percent', 'realized_vol_20d', 'vix', 'rv_iv_spread', 'rv_iv_spread_zscore', 'iv_regime_underpriced', 'iv_regime_overpriced', 'iv_regime_fair', 'volatility_regime_normal', 'volume_sma', 'volume_ratio', 'obv', 'obv_ema', 'velocity_5d', 'velocity_10d', 'velocity_20d', 'acceleration_5d', 'rsi_velocity', 'volume_velocity', 'higher_high', 'lower_low', 'gap_up', 'gap_down', 'body_size', 'upper_shadow', 'lower_shadow', 'momentum_1d', 'momentum_5d', 'momentum_20d', 'rate_of_change_10d', 'vol_ratio_5_20', 'high_low_range', 'close_position', 'volume_price_trend', 'accumulation_distribution', 'return_lag_1', 'return_lag_2', 'return_lag_5', 'rsi_cross_30', 'rsi_cross_70', 'bb_squeeze', 'volume_surge', 'rsi_momentum', 'momentum_divergence_5d', 'momentum_divergence_20d', 'rsi_3', 'rsi_14', 'rsi_divergence_3_14', 'rsi_divergence_3_14_z', 'rsi_7', 'rsi_28', 'rsi_divergence_7_28', 'rsi_divergence_7_28_z', 'distance_to_nearest_support', 'distance_to_nearest_resistance', 'support_strength', 'resistance_strength', 'broke_resistance', 'broke_support', 'days_since_support_break', 'days_since_resistance_break', 'distance_to_fib_382', 'distance_to_fib_500', 'distance_to_fib_618', 'in_consolidation_zone', 'vwap_deviation', 'vwap_volume_ratio', 'above_vwap', 'vwap_crossover', 'vwap_crossunder', 'vwap_band_position', 'vw_momentum_5d', 'vw_momentum_20d', 'volume_surge_with_price', 'large_volume_day', 'accumulation_signal', 'distribution_signal', 'vpi', 'vpi_short', 'rsi_divergence_5d', 'rsi_divergence_10d', 'rsi_divergence_20d', 'regime_low_vol', 'regime_high_vol', 'rsi_low_vol', 'rsi_high_vol', 'macd_low_vol', 'macd_high_vol', 'bb_position_low_vol']

2025-12-18 18:25:08,292 - data.feature_engineer - INFO - [OK] Feature engineering complete: (11347, 118)
2025-12-18 18:25:08,293 - __main__ - INFO - ✓ Engineered 118 features
2025-12-18 18:25:08,293 - __main__ - INFO - ✓ Saved 118 feature columns to cache
2025-12-18 18:25:08,305 - __main__ - INFO - ✓ Data preparation completed for AAPL
2025-12-18 18:25:08,310 - __main__ - INFO - 
PHASE 2A: TRAIN REGRESSOR - AAPL
2025-12-18 18:25:08,310 - __main__ - INFO - ----------------------------------------------------------------------
2025-12-18 18:32:28,876 - __main__ - INFO - GET] Preparing multi-task targets...

[INFO] Multi-task target distribution:
   Sign classes - Down: 4647 (51.6%), Flat: 6 (0.1%), Up: 4351 (48.3%)
   Volatility range: [0.0008, 0.2450]
   [OK] Sign classes prepared (3 classes: down/flat/up)
   [OK] Volatility targets prepared and scaled

[BUILD] Building model...
   Multi-task architecture: 3 output heads (magnitude + sign + volatility)

[FAIL] FATAL ERROR during regressor training: 'LSTMTransformerPaper' object has no attribute 'pos_encoding'

2025-12-18 18:32:28,877 - __main__ - WARNING - Stderr: r_final.py", line 2803, in main
    model = train_1d_regressor(
  File "/home/thunderboltdy/ai-stocks/python-ai-service/training/train_1d_regressor_final.py", line 1956, in train_1d_regressor
    model = create_multitask_regressor(
  File "/home/thunderboltdy/ai-stocks/python-ai-service/training/train_1d_regressor_final.py", line 1155, in create_multitask_regressor
    x = x + base.pos_encoding[:, :sequence_length, :]
AttributeError: 'LSTMTransformerPaper' object has no attribute 'pos_encoding'

2025-12-18 18:32:28,877 - __main__ - ERROR - Regressor training failed: Training failed with code 1
2025-12-18 18:32:28,877 - __main__ - ERROR - Traceback (most recent call last):
  File "/home/thunderboltdy/ai-stocks/python-ai-service/run_complete_pipeline.py", line 136, in train_regressor
    raise RuntimeError(f"Training failed with code {result.returncode}")
RuntimeError: Training failed with code 1

2025-12-18 18:32:28,877 - __main__ - ERROR - ⚠️ Regressor training failed for AAPL
2025-12-18 18:32:28,877 - __main__ - INFO - 
PHASE 2B: TRAIN CLASSIFIERS - AAPL
2025-12-18 18:32:28,877 - __main__ - INFO - ----------------------------------------------------------------------
2025-12-18 18:32:56,656 - __main__ - INFO - ==============


   Applying BorderlineSMOTE (balanced oversampling)...
   Before: 9028 samples, 3688 positive (40.9%)
   Target: 50/50 balance (sampling_strategy=1.00)
   Temporal weighting: Recent data (2x), Older data (1x)
   After SMOTE: 10680 samples
   Positive class: 50.0% (5340 samples)
   Synthetic samples generated: 1652
   [OK] Class balance verified: 50.0% (expected: 45-55%)

[FAIL] FATAL ERROR during classifier training: 'LSTMTransformerPaper' object has no attribute 'pos_encoding'

2025-12-18 18:32:56,656 - __main__ - WARNING - Stderr: , member_meta, _, _ = train_binary_classifiers(
  File "/home/thunderboltdy/ai-stocks/python-ai-service/training/train_binary_classifiers_final.py", line 829, in train_binary_classifiers
    buy_model = create_binary_classifier(
  File "/home/thunderboltdy/ai-stocks/python-ai-service/training/train_binary_classifiers_final.py", line 641, in create_binary_classifier
    x = x + base.pos_encoding[:, :sequence_length, :]
AttributeError: 'LSTMTransformerPaper' object has no attribute 'pos_encoding'

2025-12-18 18:32:56,656 - __main__ - ERROR - Classifiers training failed: Training failed with code 1
2025-12-18 18:32:56,656 - __main__ - ERROR - Traceback (most recent call last):
  File "/home/thunderboltdy/ai-stocks/python-ai-service/run_complete_pipeline.py", line 180, in train_classifiers
    raise RuntimeError(f"Training failed with code {result.returncode}")
RuntimeError: Training failed with code 1

2025-12-18 18:32:56,657 - __main__ - ERROR - ⚠️ Classifiers training failed for AAPL
2025-12-18 18:32:56,657 - __main__ - INFO - 
PHASE 2C: TRAIN QUANTILE REGRESSOR - AAPL
2025-12-18 18:32:56,657 - __main__ - INFO - ----------------------------------------------------------------------
2025-12-18 18:33:01,732 - __main__ - INFO - No output
2025-12-18 18:33:01,732 - __main__ - WARNING - Stderr: rformance-critical operations.
To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
usage: train_quantile_regressor.py [-h] --symbol SYMBOL [--epochs EPOCHS]
                                   [--batch-size BATCH_SIZE]
                                   [--sequence-length SEQUENCE_LENGTH]
                                   [--dropout DROPOUT]
train_quantile_regressor.py: error: the following arguments are required: --symbol

2025-12-18 18:33:01,732 - __main__ - ERROR - Quantile training failed: Training failed with code 2
2025-12-18 18:33:01,733 - __main__ - ERROR - Traceback (most recent call last):
  File "/home/thunderboltdy/ai-stocks/python-ai-service/run_complete_pipeline.py", line 225, in train_quantile
    raise RuntimeError(f"Training failed with code {result.returncode}")
RuntimeError: Training failed with code 2

2025-12-18 18:33:01,733 - __main__ - ERROR - ⚠️ Quantile training failed for AAPL
2025-12-18 18:33:01,733 - __main__ - INFO - 
PHASE 3: VALIDATION - AAPL
2025-12-18 18:33:01,733 - __main__ - INFO - ----------------------------------------------------------------------
2025-12-18 18:33:04,818 - scripts.validate_pipeline - INFO - TensorFlow GPU devices: ['/physical_device:GPU:0']
2025-12-18 18:33:05,167 - scripts.validate_pipeline - INFO - Preparing data for AAPL...
2025-12-18 18:33:05,167 - scripts.validate_pipeline - INFO - Loading cached engineered features from /home/thunderboltdy/ai-stocks/cache/AAPL/engineered_features.pkl
2025-12-18 18:33:05,249 - scripts.validate_pipeline - INFO - Loaded engineered features: 11343 rows, 152 columns
2025-12-18 18:33:05,270 - scripts.validate_pipeline - INFO - Features: 147
2025-12-18 18:33:06,498 - scripts.validate_pipeline - INFO - Train: (7897, 60, 147), Val: (1692, 60, 147), Test: (1693, 60, 147)
2025-12-18 18:33:06,944 - scripts.validate_pipeline - INFO - Training PatchTST model...
2025-12-18 18:33:06,944 - scripts.validate_pipeline - INFO -   Epochs: 0, Batch size: 256
2025-12-18 18:33:07,493 - scripts.validate_pipeline - INFO - Model parameters: 0
2025-12-18 18:33:42,906 - __main__ - ERROR - Validation failed: 'loss'
2025-12-18 18:33:42,907 - __main__ - ERROR - Traceback (most recent call last):
  File "/home/thunderboltdy/ai-stocks/python-ai-service/run_complete_pipeline.py", line 258, in validate_model
    results = run_validation(
  File "/home/thunderboltdy/ai-stocks/python-ai-service/scripts/validate_pipeline.py", line 526, in run_validation
    'epochs_trained': len(history['loss']) if history['loss'] else 0,
KeyError: 'loss'

2025-12-18 18:33:42,915 - __main__ - INFO - 
PHASE 4: BACKTESTING - AAPL
2025-12-18 18:33:42,916 - __main__ - INFO - ----------------------------------------------------------------------
2025-12-18 18:33:43,095 - __main__ - ERROR - Backtest failed: cannot import name 'backtest_symbol' from 'inference_and_backtest' (/home/thunderboltdy/ai-stocks/python-ai-service/inference_and_backtest.py)
2025-12-18 18:33:43,096 - __main__ - ERROR - Traceback (most recent call last):
  File "/home/thunderboltdy/ai-stocks/python-ai-service/run_complete_pipeline.py", line 300, in run_backtest
    from inference_and_backtest import backtest_symbol
ImportError: cannot import name 'backtest_symbol' from 'inference_and_backtest' (/home/thunderboltdy/ai-stocks/python-ai-service/inference_and_backtest.py)

2025-12-18 18:33:43,096 - __main__ - INFO - 
✓ Completed AAPL

2025-12-18 18:33:43,096 - __main__ - INFO - 

Pipeline summary saved to: /home/thunderboltdy/ai-stocks/python-ai-service/logs/pipeline_summary_20251218_181846.json
2025-12-18 18:33:43,096 - __main__ - INFO - 

======================================================================
2025-12-18 18:33:43,096 - __main__ - INFO - PIPELINE SUMMARY
2025-12-18 18:33:43,097 - __main__ - INFO - ======================================================================
2025-12-18 18:33:43,097 - __main__ - INFO - 
AAPL:
2025-12-18 18:33:43,097 - __main__ - INFO -   ✓ data_preparation: OK
2025-12-18 18:33:43,097 - __main__ - INFO -   ✗ train_regressor: Regressor training failed: Training failed with code 1
2025-12-18 18:33:43,097 - __main__ - INFO -   ✗ train_classifiers: Classifiers training failed: Training failed with code 1
2025-12-18 18:33:43,097 - __main__ - INFO -   ✗ train_quantile: Quantile training failed: Training failed with code 2
2025-12-18 18:33:43,097 - __main__ - INFO -   ✗ validation: Validation failed: 'loss'
2025-12-18 18:33:43,097 - __main__ - INFO -   ✗ backtesting: Backtest failed: cannot import name 'backtest_symbol' from 'inference_and_backtest' (/home/thunderboltdy/ai-stocks/python-ai-service/inference_and_backtest.py)
2025-12-18 18:33:43,097 - __main__ - INFO - 
======================================================================
2025-12-18 18:33:43,097 - __main__ - INFO - Pipeline completed. Log: /home/thunderboltdy/ai-stocks/python-ai-service/logs/pipeline_20251218_181846.log
2025-12-18 18:33:43,097 - __main__ - INFO - ======================================================================
